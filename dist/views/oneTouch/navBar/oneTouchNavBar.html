<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>oneTouch Navigation</title>
  </head>
  <body>
    <section class="navigation">
      <div class="nav-container">
        <div class="brand">
          <a href="./index.html"
            ><img src="./images/color_logo_transparent.png" alt="oneTouch"
          /></a>
        </div>
        <nav>
          <div class="nav-mobile">
            <a id="navbar-toggle" href="#!"><span></span></a>
          </div>
          <ul class="nav-list">
            <li>
              <a href="./index.html">Home</a>
            </li>
            <li>
              <a href="#!">Hosting</a>
              <ul class="navbar-dropdown">
                <li>
                  <a href="#!">Order a New Voip Connection</a>
                </li>
                <li>
                  <a href="#!">Cloud Touch</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="#!">Broadband</a>
              <ul class="navbar-dropdown">
                <li>
                  <a href="../oneTouch/order-new-connection.html"
                    >Order a New Connection</a
                  >
                </li>
                <li>
                  <a href="#!">Order Status</a>
                </li>
                <li>
                  <a href="#!">Connection</a>
                </li>
                <li>
                  <a href="#!">Make a Connection</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="../oneTouch/support-docs.html">Support Doc's</a>
            </li>
            <li>
              <a href="#!">Admin</a>
              <ul class="navbar-dropdown">
                <li>
                  <a href="./add-customer.html">Add User</a>
                </li>
                <li>
                  <a href="./manage-customers.html">Manage Users</a>
                </li>
                <li>
                  <a href="./raise-ticket.html">Raise Ticket</a>
                </li>
              </ul>
            </li>
            <li>
              <a href="#!">Logout</a>
            </li>
          </ul>
        </nav>
      </div>
    </section>

    <div style="position: absolute; bottom: 0; right: 0">
      <userAuthentication
        class="btnB01 backgroundLG01"
        onclick="_oneTouchUserAuthentication()"
        >UserAuthentication</userAuthentication
      >
      <loginPage
        class="btnB01 backgroundLG01"
        onclick="location.href='./one-touch-login.html';"
        >loginPage</loginPage
      >
      <clearSessionsBtn class="btnB01 backgroundPrimary"
        >Clear Sessions</clearSessionsBtn
      >
    </div>
  </body>
</html>

<script>
  //Navigation css
  (function ($) {
    $(function () {
      //  open and close nav
      $('#navbar-toggle').click(function () {
        $('nav ul').slideToggle();
      });

      // Hamburger toggle
      $('#navbar-toggle').on('click', function () {
        this.classList.toggle('active');
      });

      // If a link has a dropdown, add sub menu toggle.
      $('nav ul li a:not(:only-child)').click(function (e) {
        $(this).siblings('.navbar-dropdown').slideToggle('slow');

        // Close dropdown when select another dropdown
        $('.navbar-dropdown').not($(this).siblings()).hide('slow');
        e.stopPropagation();
      });

      // Click outside the dropdown will remove the dropdown class
      $('html').click(function () {
        $('.navbar-dropdown').hide();
      });
    });
  })(jQuery);

  document.querySelector('clearSessionsBtn').addEventListener('click', () => {
    // location.reload();
    sessionStorage.clear();
  });

  async function _oneTouchUserAuthentication() {
    console.log('User Authentication middleware');

    const URL = '/oneTouch/oneTouchUserAuthentication';
    const access_token = sessionStorage.getItem('access_token');

    const body = {
      access_token,
    };
    console.log(body);

    const config = {
      method: 'POST',
      body: JSON.stringify(body),
    };

    try {
      const response = await fetch(URL, config);
      const data = await response.json();
      if (!response.ok) throw new Error(data.msg);
      await sessionStorage.setItem('authMsg', data.msg);

      window.location.href = '/views/oneTouch/index.html';
    } catch (err) {
      await sessionStorage.setItem('authMsg', err);

      window.location.href = '/views/oneTouch/one-touch-login.html';
    }
  }
</script>
